(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["plugin-record"]=t():e["plugin-record"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fb15")}({"034f":function(e,t,r){"use strict";var n=r("85ec"),o=r.n(n);o.a},"0e05":function(e,t,r){"use strict";var n=r("a189"),o=r.n(n);o.a},"85ec":function(e,t,r){},a189:function(e,t,r){},f6fd:function(e,t){(function(e){var t="currentScript",r=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(n){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(n.stack)||[!1])[1];for(e in r)if(r[e].src==t||"interactive"==r[e].readyState)return r[e];return null}}})})(document)},fb15:function(e,t,r){"use strict";var n;(r.r(t),"undefined"!==typeof window)&&(r("f6fd"),(n=window.document.currentScript)&&(n=n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(r.p=n[1]));var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("mu-tabs",{attrs:{value:e.active1,"indicator-color":"#80deea",inverse:"",center:""},on:{"update:value":function(t){e.active1=t}}},[r("mu-tab",[e._v("直播流")]),r("mu-tab",[e._v("录制的视频")])],1),0==e.Rooms.length&&0==e.active1?r("div",{staticClass:"empty"},[r("Icon",{attrs:{type:"md-wine",size:"50"}}),e._v("没有任何房间 ")],1):0==e.active1?e._l(e.Rooms,(function(t){return r("mu-card",{key:t.StreamPath,staticClass:"room"},[r("mu-card-title",{attrs:{title:t.StreamPath,"sub-title":t.StartTime}}),r("mu-card-text",[r("p",[e._v(" "+e._s(e.SoundFormat(t.AudioInfo.SoundFormat))+" "+e._s(t.AudioInfo.PacketCount)+" "+e._s(e.SoundRate(t.AudioInfo.SoundRate))+" 声道:"+e._s(t.AudioInfo.SoundType)+" ")]),r("p",[e._v(" "+e._s(e.CodecID(t.VideoInfo.CodecID))+" "+e._s(t.VideoInfo.PacketCount)+" "+e._s(t.VideoInfo.SPSInfo.Width)+"x"+e._s(t.VideoInfo.SPSInfo.Height)+" ")])]),r("mu-card-actions",[e.isRecording(t)?r("mu-button",{staticClass:"recording",attrs:{icon:""},on:{click:function(r){return e.stopRecord(t)}}},[r("mu-icon",{attrs:{value:"fiber_manual_record"}})],1):r("mu-button",{attrs:{icon:""},on:{click:function(r){return e.record(t)}}},[r("mu-icon",{attrs:{value:"fiber_manual_record"}})],1)],1)],1)})):e._e(),1==e.active1?r("Records",{ref:"recordsPanel"}):e._e()],2)},s=[],a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"records"},e._l(e.data,(function(t){return r("mu-card",{key:t},[r("mu-card-title",{attrs:{title:t.Path,"sub-title":e.unitFormat(t.Size)+" "+e.toDurationStr(t.Duration)}}),r("mu-card-actions",[r("mu-button",{attrs:{icon:"",small:""},on:{click:function(r){return e.play(t)}}},[r("mu-icon",{attrs:{value:"play_arrow"}})],1),r("mu-button",{attrs:{icon:"",small:""},on:{click:function(r){return e.deleteFlv(t)}}},[r("mu-icon",{attrs:{value:"delete_forever"}})],1)],1)],1)})),1)},i=[],c={data(){return{data:[]}},methods:{play(e){this.ajax.get("/record/flv/play",{streamPath:e.Path.replace(".flv","")},e=>{"success"==e?(this.onVisible(!0),this.$toast.success("开始发布")):this.$toast.error(e)})},deleteFlv(e){this.$confirm("是否删除Flv文件","提示").then(t=>{if(t)return this.ajax.get("/record/flv/delete",{streamPath:e.Path.replace(".flv","")},e=>{"success"==e?this.$toast.success("删除成功"):this.$toast.error(e)})})},toDurationStr(e){if(e>1e3){let t=e/1e3;if(t>60){t|=0;let e=t/60>>0;if(e>60){let t=e/60>>0;return t+"hour"+e%60+"min"}return e+"min"+t%60+"s"}return t.toFixed(3)+"s"}return e+"ms"},onVisible(e){e&&this.ajax.getJSON("/record/flv/list",{},e=>{this.data=e})}}},u=c;r("0e05");function l(e,t,r,n,o,s,a,i){var c,u="function"===typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=r,u._compiled=!0),n&&(u.functional=!0),s&&(u._scopeId="data-v-"+s),a?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=c):o&&(c=i?function(){o.call(this,this.$root.$options.shadowRoot)}:o),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function(e,t){return c.call(t),l(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:u}}var d=l(u,a,i,!1,null,"7c800264",null),f=d.exports;let m=null;const p={0:"Linear PCM, platform endian",1:"ADPCM",2:"MP3",3:"Linear PCM, little endian",4:"Nellymoser 16kHz mono",5:"Nellymoser 8kHz mono",6:"Nellymoser",7:"G.711 A-law logarithmic PCM",8:"G.711 mu-law logarithmic PCM",9:"reserved",10:"AAC",11:"Speex",14:"MP3 8Khz",15:"Device-specific sound"},h={1:"JPEG (currently unused)",2:"Sorenson H.263",3:"Screen video",4:"On2 VP6",5:"On2 VP6 with alpha channel",6:"Screen video version 2",7:"AVC",12:"H265"};var v={components:{Records:f},data(){return{Rooms:[],typeMap:{Receiver:"📡",FlvFile:"🎥",TS:"🎬",HLS:"🍎","":"⏳",Match365:"🏆",RTMP:"🚠"}}},methods:{SoundFormat(e){return p[e]},CodecID(e){return h[e]},SoundRate(e){return e>1e3?e/1e3+"kHz":e+"Hz"},record(e){this.$Modal.confirm({title:"提示",content:"<p>是否使用追加模式</p><small>选择取消将覆盖已有文件</small>",onOk:()=>{window.ajax.get("/record/flv?append=true",{streamPath:e.StreamPath},e=>{"success"==e?this.$Message.success("开始录制(追加模式)"):this.$Message.error(e)})},onCancel:()=>{window.ajax.get("/record/flv",{streamPath:e.StreamPath},e=>{"success"==e?this.$Message.success("开始录制"):this.$Message.error(e)})}})},stopRecord(e){window.ajax.get("/record/flv/stop",{streamPath:e.StreamPath},e=>{"success"==e?this.$Message.success("停止录制"):this.$Message.error(e)})},isRecording(e){return e.SubscriberInfo&&e.SubscriberInfo.find(e=>"FlvRecord"==e.Type)},fetchRooms(){m=new EventSource("/api/summary"),m.onmessage=e=>{if(!e.data)return;let t=JSON.parse(e.data);this.Rooms=t&&t.Rooms||[],this.Rooms.sort((e,t)=>e.StreamPath>t.StreamPath?1:-1)}},onClickTab(e){this.$refs.recordsPanel.onVisible("recordsPanel"==e)}},mounted(){this.fetchRooms()},destroyed(){m.close()}},_=v,S=(r("034f"),l(_,o,s,!1,null,null,null)),y=S.exports;t["default"]=y}})["default"]}));
//# sourceMappingURL=plugin-record.umd.min.js.map